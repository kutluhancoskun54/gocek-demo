<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Göcek Lokantası – Marina İndirimi</title>
  <meta name="description" content="Marina indirimi için tek kullanımlık kod üret." />
  <style>
    :root{
      --bg1:#071018; --bg2:#120a10;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --brand:#78ead3;
      --brand2:#f88451;
      --danger:#ff6b6b;
      --ok:#7CFFB2;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(900px 600px at 20% 15%, rgba(120,234,211,.20), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(248,132,81,.18), transparent 55%),
        radial-gradient(1200px 900px at 50% 110%, rgba(221,13,3,.10), transparent 60%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:28px 18px 80px}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px;
      padding:14px 14px;
      background:rgba(0,0,0,.22);
      border:1px solid var(--stroke);
      border-radius:999px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      padding-left:6px;
      min-width: 240px;
    }
    .logo{
      width:36px; height:36px; border-radius:10px;
      background:rgba(255,255,255,.12);
      border:1px solid var(--stroke);
      display:grid; place-items:center;
      overflow:hidden;
    }
    .logo img{width:100%; height:100%; object-fit:cover}
    .brand h1{margin:0; font-size:14px; letter-spacing:.2px}
    .brand p{margin:2px 0 0; font-size:12px; color:var(--muted)}
    .nav{
      display:flex; flex-wrap:wrap; gap:8px;
      justify-content:flex-end;
    }
    .pill{
      padding:10px 14px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      border-radius:999px;
      font-size:13px;
      color:var(--text);
      transition:.15s ease;
      white-space:nowrap;
    }
    .pill:hover{transform: translateY(-1px); background:rgba(255,255,255,.09)}
    .pill.primary{border-color: rgba(120,234,211,.45); box-shadow: 0 0 0 1px rgba(120,234,211,.12) inset}
    .grid{
      margin-top:22px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
      .brand{min-width:auto}
    }
    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:18px;
    }
    .card h2{margin:0 0 6px; font-size:18px}
    .card p{margin:0 0 14px; color:var(--muted); font-size:13px; line-height:1.5}
    .row{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:end;
      margin-top:10px;
    }
    label{font-size:12px; color:var(--muted)}
    input{
      width:100%;
      padding:12px 12px;
      background: rgba(0,0,0,.28);
      color:var(--text);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      outline:none;
      font-size:14px;
    }
    input:focus{border-color: rgba(120,234,211,.55); box-shadow: 0 0 0 3px rgba(120,234,211,.12)}
    .btn{
      padding:12px 14px;
      border-radius: 12px;
      border:1px solid rgba(120,234,211,.45);
      background: rgba(120,234,211,.14);
      color:var(--text);
      cursor:pointer;
      font-weight:600;
      transition:.15s ease;
      min-width: 120px;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(120,234,211,.18)}
    .btn:disabled{opacity:.55; cursor:not-allowed; transform:none}
    .note{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
    }
    .result{
      margin-top:14px;
      padding:14px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
    }
    .kv{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .code{
      font-size:22px;
      letter-spacing: 1.2px;
      font-weight:800;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(120,234,211,.40);
      background: rgba(120,234,211,.10);
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .mini{
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      font-weight:700;
      color:var(--text);
      transition:.15s ease;
    }
    .mini:hover{transform: translateY(-1px); background: rgba(255,255,255,.08)}
    .status{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size:13px;
    }
    .status.ok{border-color: rgba(124,255,178,.35); color: rgba(124,255,178,.95)}
    .status.err{border-color: rgba(255,107,107,.35); color: rgba(255,190,190,.98)}
    .side h3{margin:0 0 6px; font-size:16px}
    .list{
      display:grid; gap:10px;
      margin-top:10px;
    }
    .item{
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size:13px;
      line-height:1.5;
    }
    .footer{
      margin-top:18px;
      text-align:center;
      color: rgba(255,255,255,.55);
      font-size:12px;
    }

    /* Sağ alt ikonlar */
    .fab{
      position:fixed;
      right:16px;
      bottom:16px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:50;
    }
    .fab a{
      width:44px; height:44px;
      display:grid; place-items:center;
      border-radius: 14px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      transition:.15s ease;
    }
    .fab a:hover{transform: translateY(-2px); background: rgba(0,0,0,.42)}
    .icon{width:18px; height:18px; opacity:.95}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-label="Göcek Lokantası">
          <!-- Logon varsa assets içine koyup src'yi değiştir: assets/logo.png -->
          <img src="assets/logo.png" alt="" onerror="this.remove(); this.parentElement.textContent='G'; this.parentElement.style.fontWeight='900';" />
        </div>
        <div>
          <h1>Göcek Lokantası</h1>
          <p>Marina İndirimi • Tek Kullanımlık Kod</p>
        </div>
      </div>

      <div class="nav">
        <a class="pill" href="/">Ana Sayfa</a>
        <a class="pill primary" href="/marina">Marina indirimi</a>
        <a class="pill" href="/dashboard">Dashboard</a>
        <a class="pill" id="btnWhatsapp" href="#" rel="noopener">WhatsApp</a>
        <a class="pill" id="btnMaps" href="#" rel="noopener">Konum</a>
        <a class="pill" id="btnInstagram" href="#" rel="noopener">Instagram</a>
      </div>
    </div>

    <div class="grid">
      <!-- SOL: Kod üretme (MÜŞTERİ SAYFASI) -->
      <div class="card">
        <h2>Marina İndirimi – Kod Üret</h2>
        <p>
          Pedalstar/stand ID’niz <b>PS001</b> formatında olmalı. Kod üretince kasada gösterin.
          Kod <b>10 dakika</b> geçerlidir.
        </p>

        <div class="row">
          <div>
            <label for="pedalstar">Pedalstar ID</label>
            <input id="pedalstar" placeholder="Örn: PS001" autocomplete="off" />
          </div>
          <button class="btn" id="btnGenerate">Kod Üret</button>
        </div>

        <div class="note">
          İpucu: QR linki şöyle olursa otomatik dolar → <b>/marina?pedalstar=PS001</b>
        </div>

        <div id="out" class="result" style="display:none">
          <div class="kv">
            <div class="code">
              <span id="codeText">------</span>
              <button class="mini" id="btnCopy" type="button">Kopyala</button>
            </div>
            <div style="color:var(--muted); font-size:13px">
              Bitiş: <b id="expiresText">-</b>
            </div>
          </div>
          <div class="status ok" style="margin-top:12px">
            Kodu kasada gösterin. Süre dolarsa tekrar kod üretebilirsiniz.
          </div>
        </div>

        <div id="status" class="status" style="display:none"></div>

        <div class="footer">© <span id="year"></span> Göcek Lokantası</div>
      </div>

      <!-- SAĞ: Bilgi kutusu (DASHBOARD/LİSTE YOK) -->
      <div class="card side">
        <h3>Nasıl kullanılır?</h3>
        <div class="list">
          <div class="item">
            1) Pedalstar ID alanına <b>PS001</b> gibi ID girin (QR otomatik doldurabilir).
          </div>
          <div class="item">
            2) <b>Kod Üret</b> ile kod oluşturun.
          </div>
          <div class="item">
            3) Kodu kasaya gösterin. Kod tek kullanımlıktır.
          </div>
          <div class="item">
            Personel kontrol ekranı: <b>/dashboard</b> (token ile).
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sağ alt ikonlar: WhatsApp, Konum, Instagram -->
  <div class="fab" aria-label="Hızlı Bağlantılar">
    <a id="fabWhatsapp" href="#" title="WhatsApp" rel="noopener">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <path d="M20.5 11.9c0 4.7-3.8 8.6-8.5 8.6-1.5 0-2.9-.4-4.2-1l-3.3 1 .9-3.2a8.6 8.6 0 0 1-1.3-4.6C4.1 7.2 8 3.3 12.7 3.3c4.7 0 7.8 3.9 7.8 8.6Z" stroke="white" opacity=".9"/>
        <path d="M10.2 9.3c-.2-.4-.4-.4-.7-.4h-.6c-.2 0-.4.1-.6.3-.2.3-.8.8-.8 2s.8 2.3.9 2.5c.1.2 1.5 2.4 3.6 3.2 1.7.7 2.1.6 2.4.5.3-.1 1-.4 1.1-.9.1-.5.1-.9 0-1-.1-.1-.3-.2-.6-.3l-1.4-.7c-.2-.1-.4-.1-.6.1l-.5.6c-.2.2-.3.2-.5.1-.2-.1-.9-.3-1.6-1a6 6 0 0 1-1.1-1.4c-.1-.2 0-.4.1-.5l.4-.4c.1-.1.2-.3.3-.4.1-.2.1-.3 0-.5l-.6-1.3Z" fill="white" opacity=".9"/>
      </svg>
    </a>
    <a id="fabMaps" href="#" title="Konum" rel="noopener">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <path d="M12 22s7-5.2 7-12a7 7 0 1 0-14 0c0 6.8 7 12 7 12Z" stroke="white" opacity=".9"/>
        <path d="M12 13.2a3.2 3.2 0 1 0 0-6.4 3.2 3.2 0 0 0 0 6.4Z" fill="white" opacity=".9"/>
      </svg>
    </a>
    <a id="fabInstagram" href="#" title="Instagram" rel="noopener">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <path d="M7.5 3.5h9A4 4 0 0 1 20.5 7.5v9a4 4 0 0 1-4 4h-9a4 4 0 0 1-4-4v-9a4 4 0 0 1 4-4Z" stroke="white" opacity=".9"/>
        <path d="M12 16.2a4.2 4.2 0 1 0 0-8.4 4.2 4.2 0 0 0 0 8.4Z" stroke="white" opacity=".9"/>
        <path d="M17.3 6.7h.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </a>
  </div>

  <script>
    // ==== SABİT LİNKLER (SENİN VERDİKLERİN) ====
    const SITE = {
      WHATSAPP_NUMBER: "905394105058",
      INSTAGRAM_URL: "https://instagram.com/goceklokantasi",
      MAPS_DIRECTIONS_URL: "https://share.google/qVl6WHz6QGHft2Vl6"
    };

    // Top bar + sağ alt ikonları bağla
    const waText = "Merhaba, marina indirimi hakkında bilgi alabilir miyim?";
    const waUrl  = `https://wa.me/${SITE.WHATSAPP_NUMBER}?text=${encodeURIComponent(waText)}`;

    function bind(id, url){
      const el = document.getElementById(id);
      if (el) el.href = url;
    }
    ["btnWhatsapp","fabWhatsapp"].forEach(id => bind(id, waUrl));
    ["btnInstagram","fabInstagram"].forEach(id => bind(id, SITE.INSTAGRAM_URL));
    ["btnMaps","fabMaps"].forEach(id => bind(id, SITE.MAPS_DIRECTIONS_URL));

    // ==== Pedalstar parametresini URL'den al (QR ile otomatik dolsun) ====
    const qs = new URLSearchParams(location.search);
    const pedalstarFromUrl = (qs.get("pedalstar") || qs.get("pedalstar_id") || "").trim().toUpperCase();
    const pedalInput = document.getElementById("pedalstar");
    if (pedalstarFromUrl) pedalInput.value = pedalstarFromUrl;

    const statusEl = document.getElementById("status");
    const outEl = document.getElementById("out");
    const codeTextEl = document.getElementById("codeText");
    const expiresTextEl = document.getElementById("expiresText");
    const btnGenerate = document.getElementById("btnGenerate");
    const btnCopy = document.getElementById("btnCopy");

    function showStatus(kind, msg){
      statusEl.style.display = "block";
      statusEl.className = "status " + (kind === "err" ? "err" : "ok");
      statusEl.textContent = msg;
    }
    function clearStatus(){
      statusEl.style.display = "none";
      statusEl.textContent = "";
      statusEl.className = "status";
    }

    async function generateCode(){
      clearStatus();
      outEl.style.display = "none";

      const pedalstar = (pedalInput.value || "").trim().toUpperCase();
      if (!/^PS\\d{3}$/.test(pedalstar)){
        showStatus("err", "Pedalstar ID hatalı. Örn: PS001");
        return;
      }

      btnGenerate.disabled = true;
      btnGenerate.textContent = "Üretiliyor...";

      try{
        // NOT: Mutlaka .netlify yolunu kullan
        const url = `/.netlify/functions/generate?pedalstar=${encodeURIComponent(pedalstar)}`;
        const res = await fetch(url, { method:"GET" });
        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok){
          const m = data?.error || `Hata (${res.status})`;
          const d = data?.detail ? ` — ${data.detail}` : "";
          showStatus("err", m + d);
          return;
        }

        codeTextEl.textContent = data.code || "------";
        expiresTextEl.textContent = data.expires_at ? new Date(data.expires_at).toLocaleString("tr-TR") : "-";
        outEl.style.display = "block";
        showStatus("ok", "Kod üretildi.");
      }catch(e){
        showStatus("err", "Sunucu hatası: " + String(e));
      }finally{
        btnGenerate.disabled = false;
        btnGenerate.textContent = "Kod Üret";
      }
    }

    btnGenerate.addEventListener("click", generateCode);

    btnCopy.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(codeTextEl.textContent.trim());
        showStatus("ok", "Kopyalandı.");
      }catch(e){
        showStatus("err", "Kopyalama başarısız.");
      }
    });

    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
