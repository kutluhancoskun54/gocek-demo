<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Göcek Lokantası – Marina İndirimi</title>

  <style>
    :root{
      --bg1:#06131a;
      --bg2:#0b0f1f;
      --glass: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --accent: #78ead3;
      --danger: rgba(255,60,80,.22);
      --dangerStroke: rgba(255,60,80,.35);
      --ok: rgba(80,220,150,.18);
      --okStroke: rgba(80,220,150,.35);
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r: 18px;
      --r2: 26px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 450px at 18% 18%, rgba(120,234,211,.22), transparent 60%),
        radial-gradient(800px 520px at 85% 20%, rgba(248,132,81,.18), transparent 55%),
        radial-gradient(900px 600px at 70% 80%, rgba(221,13,3,.12), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    .wrap{
      max-width: 1100px;
      margin: 26px auto 40px;
      padding: 0 18px 60px;
    }

    .topbar{
      display:flex;
      align-items:center;
      gap:14px;
      padding: 12px 14px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-radius: 999px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 260px;
      padding-left: 4px;
    }
    .logo{
      width:36px;height:36px;border-radius:10px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      display:grid;place-items:center;
      overflow:hidden;
    }
    .brand .t1{font-weight:700; letter-spacing:.2px; line-height:1.1}
    .brand .t2{font-size:12px; color:var(--muted); line-height:1.1}

    .nav{
      display:flex;
      gap:10px;
      flex:1;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .pill{
      appearance:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 9px 14px;
      border-radius: 999px;
      text-decoration:none;
      font-size: 13px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .pill:hover{transform: translateY(-1px); background: rgba(255,255,255,.09)}
    .pill.active{
      border-color: rgba(120,234,211,.45);
      background: rgba(120,234,211,.12);
    }

    .grid{
      margin-top: 22px;
      display:grid;
      grid-template-columns: 1.3fr .9fr;
      gap: 18px;
    }
    @media (max-width: 900px){
      .brand{min-width:auto}
      .grid{grid-template-columns:1fr}
      .nav{justify-content:flex-start}
    }

    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.075), rgba(255,255,255,.04));
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      padding: 18px;
    }

    h1{
      margin: 0 0 6px;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0 0 14px;
      font-size: 13px;
      color: var(--muted);
      line-height:1.45;
    }

    .row{
      display:flex;
      gap: 10px;
      align-items:center;
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin: 10px 0 6px;
    }

    input{
      width:100%;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding: 12px 12px;
      outline:none;
      font-size: 14px;
    }
    input::placeholder{color: rgba(255,255,255,.40)}
    input:focus{border-color: rgba(120,234,211,.45)}

    .btn{
      border-radius: 14px;
      border:1px solid rgba(120,234,211,.35);
      background: rgba(120,234,211,.14);
      color: var(--text);
      padding: 12px 14px;
      font-weight: 650;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(120,234,211,.18)}
    .btn:disabled{opacity:.55; cursor:not-allowed; transform:none}

    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      padding:10px 12px;
      border-radius: 14px;
    }

    .msg{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      font-size: 13px;
      color: var(--text);
      display:none;
    }
    .msg.ok{display:block; border-color: var(--okStroke); background: var(--ok)}
    .msg.err{display:block; border-color: var(--dangerStroke); background: var(--danger)}
    .msg.neu{display:block}

    .steps{
      display:grid;
      gap:10px;
      margin-top: 10px;
    }
    .step{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      color: var(--muted);
      line-height:1.45;
    }
    .step b{color:var(--text)}

    footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(255,255,255,.45);
      font-size: 12px;
    }

    .float{
      position: fixed;
      right: 16px;
      bottom: 18px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      z-index: 99;
    }
    .fab{
      width: 44px; height: 44px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      display:grid;
      place-items:center;
      box-shadow: 0 14px 40px rgba(0,0,0,.45);
      cursor:pointer;
      transition: transform .08s ease, background .15s ease;
      text-decoration:none;
    }
    .fab:hover{transform: translateY(-1px); background: rgba(0,0,0,.35)}
    .fab svg{width:20px;height:20px; fill: rgba(255,255,255,.86)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="t1">Göcek Lokantası</div>
          <div class="t2">Marina indirimi • Tek Kullanımlık Kod</div>
        </div>
      </div>

      <nav class="nav" aria-label="Üst Menü">
        <a class="pill" href="/">Ana Sayfa</a>
        <a class="pill active" href="/marina">Marina indirimi</a>
        <a class="pill" id="btnWhatsapp" href="#" target="_blank" rel="noopener">WhatsApp</a>
        <a class="pill" id="btnMaps" href="#" target="_blank" rel="noopener">Konum</a>
        <a class="pill" id="btnInstagram" href="#" target="_blank" rel="noopener">Instagram</a>
      </nav>
    </div>

    <div class="grid">
      <section class="card">
        <h1>Marina indirimi — Kod Üret</h1>
        <p class="sub">
          Pedalstar/stand ID’niz <b>PS001</b> formatında olmalı. Kod ürettikten sonra kasada gösterin.
          Kod <b>10 dakika</b> geçerlidir.
        </p>

        <label for="pedalstar">Pedalstar ID</label>
        <div class="row">
          <input id="pedalstar" placeholder="Örn: PS001" autocomplete="off" />
          <button id="btnGenerate" class="btn">Kod Üret</button>
        </div>

        <div class="hint">
          QR linki örneği → <b>/marina?pedalstar=PS001</b>
        </div>

        <div id="msg" class="msg neu"></div>
        <footer>© <span id="year"></span> Göcek Lokantası</footer>
      </section>

      <aside class="card">
        <h1>Nasıl kullanılır?</h1>
        <div class="steps">
          <div class="step"><b>1)</b> Pedalstar ID alanına <b>PS001</b> gibi ID girin (QR otomatik doldurur).</div>
          <div class="step"><b>2)</b> <b>Kod Üret</b> ile kod oluşturun.</div>
          <div class="step"><b>3)</b> Kodu kasaya gösterin. Kod tek kullanımlık ve <b>10 dakika</b> geçerlidir.</div>
        </div>

        <div class="hint" style="margin-top:12px">
          Not: Bu sayfa yalnızca pedalstar QR ile açılır.
        </div>
      </aside>
    </div>
  </div>

  <div class="float" aria-label="Hızlı Erişim">
    <a class="fab" id="fabWhatsapp" href="#" target="_blank" rel="noopener" aria-label="WhatsApp">
      <svg viewBox="0 0 32 32" aria-hidden="true"><path d="M19.11 17.46c-.27-.13-1.6-.79-1.85-.88-.25-.09-.43-.13-.62.13-.18.27-.71.88-.88 1.06-.16.18-.31.2-.58.07-.27-.13-1.12-.41-2.14-1.31-.79-.7-1.33-1.56-1.49-1.83-.16-.27-.02-.42.12-.55.12-.12.27-.31.4-.47.13-.16.18-.27.27-.44.09-.18.04-.33-.02-.47-.07-.13-.62-1.5-.85-2.06-.22-.53-.45-.46-.62-.46l-.53-.01c-.18 0-.47.07-.71.33-.25.27-.94.92-.94 2.24s.96 2.6 1.09 2.78c.13.18 1.89 2.88 4.58 4.04.64.28 1.14.44 1.53.57.64.2 1.23.17 1.69.1.52-.08 1.6-.65 1.83-1.28.23-.62.23-1.16.16-1.28-.06-.12-.25-.2-.52-.33zM16.01 3.2c-6.99 0-12.67 5.69-12.67 12.68 0 2.21.58 4.37 1.69 6.27L3.2 28.8l6.83-1.79a12.64 12.64 0 0 0 5.98 1.52h.01c6.99 0 12.67-5.69 12.67-12.68S23 3.2 16.01 3.2zm0 23.17h-.01c-1.9 0-3.77-.51-5.42-1.47l-.39-.23-4.05 1.06 1.08-3.95-.25-.41a10.5 10.5 0 0 1-1.6-5.6c0-5.79 4.71-10.5 10.5-10.5S26.5 9.98 26.5 15.77 21.79 26.37 16.01 26.37z"/></svg>
    </a>

    <a class="fab" id="fabMaps" href="#" target="_blank" rel="noopener" aria-label="Konum">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5A2.5 2.5 0 1 1 12 6a2.5 2.5 0 0 1 0 5.5z"/></svg>
    </a>

    <a class="fab" id="fabInstagram" href="#" target="_blank" rel="noopener" aria-label="Instagram">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2zm0 2A3.5 3.5 0 0 0 4 7.5v9A3.5 3.5 0 0 0 7.5 20h9a3.5 3.5 0 0 0 3.5-3.5v-9A3.5 3.5 0 0 0 16.5 4h-9zM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm5.75-2.5a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>
    </a>
  </div>

  <script>
    const SITE = {
      WHATSAPP_NUMBER: "905394105058",
      INSTAGRAM_URL: "https://instagram.com/goceklokantasi",
      MAPS_DIRECTIONS_URL: "https://maps.app.goo.gl/Vf6fVwdSiV2JRdb36"
    };

    // ✅ QR şartı (pedalstar paramı yoksa sayfa açılmaz)
    const qs = new URLSearchParams(location.search);
    const pedalFromQS = (qs.get("pedalstar") || qs.get("pedalstar_id") || "").trim().toUpperCase().replace(/\s+/g,"");
    const isValidPS = (s) => /^PS\d{3}$/.test(s);

    if (!isValidPS(pedalFromQS)) {
      // burada “marina sayfası sadece QR ile açılacak” şartı uygulanıyor
      // yanlış/boş girişte ana sayfaya döndür
      location.replace("/");
    }

    const waText = "Merhaba, marina indirimi hakkında bilgi alabilir miyim?";
    const waUrl  = `https://wa.me/${SITE.WHATSAPP_NUMBER}?text=${encodeURIComponent(waText)}`;

    const bind = (id, url) => {
      const el = document.getElementById(id);
      if (el) el.href = url;
    };

    ["btnWhatsapp","fabWhatsapp"].forEach(id => bind(id, waUrl));
    ["btnInstagram","fabInstagram"].forEach(id => bind(id, SITE.INSTAGRAM_URL));
    ["btnMaps","fabMaps"].forEach(id => bind(id, SITE.MAPS_DIRECTIONS_URL));

    document.getElementById("year").textContent = new Date().getFullYear();

    const pedalInput = document.getElementById("pedalstar");
    pedalInput.value = pedalFromQS;

    const msg = document.getElementById("msg");
    const setMsg = (type, text) => {
      msg.className = "msg " + (type || "neu");
      msg.textContent = text;
      msg.style.display = "block";
    };

    const normalizePS = (s) => (s || "").toString().trim().toUpperCase().replace(/\s+/g, "");

    const btn = document.getElementById("btnGenerate");
    btn.addEventListener("click", async () => {
      const pedalstar = normalizePS(pedalInput.value);

      if (!isValidPS(pedalstar)) {
        setMsg("err", "Invalid pedalstar id. Expected PS001 format.");
        return;
      }

      btn.disabled = true;
      btn.textContent = "Üretiliyor...";
      setMsg("neu", "Kod üretiliyor...");

      try {
        const url = `/.netlify/functions/generate?pedalstar=${encodeURIComponent(pedalstar)}`;
        const res = await fetch(url, { method: "GET" });

        const data = await res.json().catch(() => ({}));
        if (!res.ok || !data || !data.ok) {
          const detail = data?.detail ? (" " + data.detail) : "";
          throw new Error((data?.error || "Kod üretilemedi.") + detail);
        }

        setMsg("ok", `Kodunuz: ${data.code} (Bitiş: ${new Date(data.expires_at).toLocaleString("tr-TR")})`);
      } catch (e) {
        setMsg("err", String(e?.message || e));
      } finally {
        btn.disabled = false;
        btn.textContent = "Kod Üret";
      }
    });
  </script>
</body>
</html>
